{% extends 'base.html' %}

{% block title %}Swimming Classes{% endblock %}

{% block content %}
<div class="container">
    <h1>Swimming Classes</h1>
    
    <!-- Dynamic Day Navigation Buttons with Date Picker -->
    <div class="day-navigation text-center">
        <button onclick="navigateDay(-1)" class="btn btn-info">&lt; Previous Day</button>
        <input type="date" id="datePicker" class="form-control" onchange="navigateToDate()" style="width: auto; display: inline-block; margin: 0 15px;" value="{{ selected_date }}">
        <button onclick="navigateDay(1)" class="btn btn-info">Next Day &gt;</button>
    </div>

    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>Time</th>
                    {% for date_info in dates %}
                    <th>{{ date_info.strftime('%A') }}<br>{{ date_info.strftime('%d %b') }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for time_slot in time_slots %}
                <tr>
                    <td>{{ time_slot }}</td>
                    {% for date_info in dates %}
                    <td>
                        {% set day_classes = timetable.get(date_info.strftime('%Y-%m-%d'), {}).get(time_slot, []) %}
                        {% for class_info in day_classes %}
                        <div class="class-container">
                            <div class="timetable__content-title fw-500">{{ class_info.name }}</div>
                            <div class="timetable__flex--start fw-400">
                                <i class="fa-solid fa-location-dot fa-fw timetable__icon"></i>
                                Pool Type: {{ class_info.pool_type }}
                            </div>
                            <div class="timetable__flex--start fw-400">
                                <i class="fa-regular fa-circle-user fa-fw timetable__icon"></i>
                                Space: {{ class_info.availability }}
                            </div>
                            <progress value="{{ class_info.availability }}" max="100" title="{{ class_info.availability }}%" aria-hidden="true" class="timetable__content-space"></progress>
                            <div>Instr: {{ class_info.instructor }}</div>
                            {% if class_info['class_id'] in user_booked_classes %}
                                <button class="btn btn-secondary disabled">Already Booked</button>
                            {% elif class_info.availability > 0 %}
                                <a href="{{ url_for('booking_class', class_id=class_info['class_id']) }}" class="btn btn-primary">Book Now</a>
                            {% else %}
                                <button class="btn btn-secondary disabled">No Space</button>
                            {% endif %}
                        </div>
                        {% else %}
                        <span>No classes</span>
                        {% endfor %}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    document.getElementById('datePicker').value = "{{ selected_date }}";

    function navigateDay(offset) {
        var datePicker = document.getElementById('datePicker');
        var currentDate = new Date(datePicker.value);
        currentDate.setDate(currentDate.getDate() + offset);
        datePicker.valueAsDate = currentDate;
        navigateToDate();
    }

    function navigateToDate() {
        var datePicker = document.getElementById('datePicker');
        var selectedDate = datePicker.value;
        var url = new URL(window.location.href);
        url.searchParams.set('date', selectedDate);
        window.location.href = url;
    }
</script>

<style>
    .day-navigation {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .btn-info {
        margin: 0 10px; /* Adjusted margin for better alignment */
    }

    td {
        vertical-align: top;
        width: calc(100% / {{ dates|length }} - 2px);
    }

    .class-container {
        border: 1px solid #dee2e6;
        padding: 4px;
        margin-bottom: 5px;
        background-color: #f8f9fa;
        display: flex;
        flex-direction: column;
    }

    .class-container > .timetable__content-title {
        font-size: 12px;
        font-weight: bold;
    }

    .class-container > .timetable__flex--start,
    .class-container > .btn,
    .class-container > .timetable__content-space,
    .class-container > .timetable__icon,
    .class-container > progress,
    .class-container > div {
        font-size: 12px;
        padding: 3px 8px;
    }

    .class-container > .timetable__flex--start:nth-child(3) {
        font-weight: bold;
        color: green;
    }
    td span {
        color: #ccc;
    }
</style>
{% include 'homepage/footer.html' %}
{% endblock %}
