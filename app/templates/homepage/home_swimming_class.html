{% extends 'base.html' %}

{% block title %}Swimming Classes{% endblock %}

{% block content %}
<div class="about-image d-flex align-items-center justify-content-center">
    <div class="text-center text-white">
      <h1>A SWIM CLUB THAT COMES TO YOU</h1>
      <p>THE BEST PLACE FOR FUN AND PLAY</p>
    </div>
</div>
  
<div class="container">
    <div class="heading text-black mt-5 mb-5">
        <h2>Aerobics Class Timetable</h2>
    </div>
    <div class="intro-text">
        <p>Our club now has provided 13 types of Aerobics Classes! All classes can only be booked for up to 15 people.</p>
        <p><em>*Zumba, Aqua Fit, Low-Impact, Mums, Babies, Aqua Fusion Flow, 
            HydroFit Power Hour, Splash Dance Cardio, Aqua Sculpt & Tone, 
            Aqua Zen Stretch, HydroBlast Intensity, Aqua Beat Blast, Splash & Dash HIIT.</em></p>
        <p>Events are to behold in Deep Pool.</p>
    </div>
    <!-- Dynamic Day Navigation Buttons with Date Picker -->
    <div class="day-navigation text-center mt-5 mb-5">
        <button onclick="navigateDay(-1)" class="btn btn-primary">&lt; Previous Day</button>
        <input type="date" id="datePicker" class="form-control" onchange="navigateToDate()" 
        style="width: auto; display: inline-block; margin: 0 15px;" value="{{ selected_date }}">
        <button onclick="navigateDay(1)" class="btn btn-primary">Next Day &gt;</button>
    </div>
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>Time</th>
                    {% for date_info in dates %}
                        <th>{{ date_info.strftime('%A') }}<br>{{ date_info.strftime('%d %b') }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for time_slot in time_slots %}
                    <tr>
                        <td>{{ time_slot }}</td>
                        {% for date_info in dates %}
                            <td>
                                {% set day_classes = timetable.get(date_info.strftime('%Y-%m-%d'), {}).get(time_slot, []) %}
                                {% for class_info in day_classes %}
                                    <div class="class-container {% if class_info['datetime'] < current_datetime %}expired{% elif class_info['class_status'] == 'Cancelled' %}cancelled{% endif %}">
                                        <div class="timetable__content-title fw-500">
                                            {{ class_info['name'] }}
                                        </div>
                                        <div class="timetable__flex--start fw-400">
                                            {{ class_info['description'] | default('No description provided.') }}
                                        </div>
                                        <div class="timetable__flex--start fw-400">
                                            Space: {{ class_info['availability'] }}
                                        </div>
                                        <div>Instr: {{ class_info['instructor'] }}</div>
                                        
                                        {% if class_info['datetime'] < current_datetime %}
                                            {% if class_info['class_status'] == 'Cancelled' %}
                                                <button class="btn btn-danger disabled">Class Cancelled</button>
                                            {% else %}
                                                <button class="btn btn-secondary disabled">Expired</button>
                                            {% endif %}
                                        {% elif class_info['class_status'] == 'Cancelled' %}
                                            <button class="btn btn-danger disabled">Class Cancelled</button>
                                        {% elif class_info['availability'] > 0 %}
                                            <button class="btn btn-success disabled">Class Open</button>
                                        {% else %}
                                            <button class="btn btn-secondary disabled">No Space</button>
                                        {% endif %}
                                    </div>
                                {% else %}
                                    <span>No classes available</span>
                                {% endfor %}
                            </td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
function navigateDay(offset) {
    var datePicker = document.getElementById('datePicker');
    var currentDate = new Date(datePicker.value);
    currentDate.setDate(currentDate.getDate() + offset);
    datePicker.valueAsDate = currentDate;
    navigateToDate();
}

function navigateToDate() {
    var datePicker = document.getElementById('datePicker');
    var selectedDate = datePicker.value;
    var url = new URL(window.location.href);
    url.searchParams.set('date', selectedDate);
    window.history.pushState({ path: url.toString() }, '', url.toString());
    location.reload();
}

window.onload = function() {
    var datePicker = document.getElementById('datePicker');
    window.scrollTo(0, datePicker.offsetTop - 100); 
};
</script>

{% include 'homepage/footer.html' %}
{% endblock %}
