{% extends 'base.html' %}

{% block title %}Swimming Classes{% endblock %}

{% block content %}
<div class="about-image d-flex align-items-center justify-content-center">
    <div class="text-center text-white">
      <h1>A SWIM CLUB THAT COMES TO YOU</h1>
      <p>THE BEST PLACE FOR FUN AND PLAY</p>
    </div>
</div>
  
<div class="container">
    <div class="heading text-black mt-5 mb-5">
        <h2>Aerobics Class Timetable</h2>
    </div>
    <div class="intro-text">
        <p>Our club now has provided 13 types of Aerobics Classes! All classes can only be booked for up to 15 people.</p>
        <p><em>*Zumba, Aqua Fit, Low-Impact, Mums, Babies, Aqua Fusion Flow, 
            HydroFit Power Hour, Splash Dance Cardio, Aqua Sculpt & Tone, 
            Aqua Zen Stretch, HydroBlast Intensity, Aqua Beat Blast, Splash & Dash HIIT.</em></p>
        <p>Events are to behold in Deep Pool.</p>
    </div>
    <!-- Dynamic Day Navigation Buttons -->
    <div class="day-navigation text-center mt-5 mb-5">
        <button onclick="navigateDay(-1)" class="btn btn-primary">&lt; Previous Day</button>
        <input type="date" id="datePicker" class="form-control" onchange="navigateToDate()" 
        style="width: auto; display: inline-block; margin: 0 15px;" value="{{ selected_date }}">
        <button onclick="navigateDay(1)" class="btn btn-primary">Next Day &gt;</button>
    </div>
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>Time</th>
                    {% for date_info in dates %}
                    <th>{{ date_info.strftime('%A') }}<br>{{ date_info.strftime('%d %b') }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for time_slot in time_slots %}
                <tr>
                    <td>{{ time_slot }}</td>
                    {% for date_info in dates %}
                    <td>
                        {% set day_classes = timetable.get(date_info.date(), {}).get(time_slot, []) %}
                        {% for class_info in day_classes %}
                        <div class="class-container">
                            <div class="timetable__content-title fw-500">
                                {{ class_info.name }}
                            </div>
                            <div class="timetable__flex--start fw-400">
                                {{ class_info.description|truncate(50) }}
                            </div>
                            <div class="timetable__flex--start fw-400">
                                Availability: {{ class_info.availability }}
                            </div>
                            <div>Instructor: {{ class_info.instructor }}</div>
                        </div>
                        {% else %}
                        <span>No classe</span>
                        {% endfor %}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    function navigateDay(offset) {
        var url = new URL(window.location);
        var currentDate = new Date(url.searchParams.get('date') || new Date().toISOString().split('T')[0]);
        currentDate.setDate(currentDate.getDate() + offset);
        url.searchParams.set('date', currentDate.toISOString().split('T')[0]);

        sessionStorage.setItem('scrollPosition', window.scrollY);

        history.pushState({}, '', url.toString());

        fetch(url)
        .then(response => response.text())
        .then(data => {
            document.querySelector('main').innerHTML = data;

                var scrollPosition = sessionStorage.getItem('scrollPosition');
                if (scrollPosition) {
                    window.scrollTo(0, parseInt(scrollPosition));
                    sessionStorage.removeItem('scrollPosition');
                }
            })
            .catch(error => console.error('Error:', error));
    }

    window.onload = function() {
        var scrollPosition = sessionStorage.getItem('scrollPosition');
        if (scrollPosition) {
            window.scrollTo(0, parseInt(scrollPosition));
            sessionStorage.removeItem('scrollPosition');
        }
    };
</script>

{% include 'homepage/footer.html' %}
{% endblock %}
